<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.18/index.global.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="http://localhost/Estagio-Ferias---Calendario-Eniac/static/calendarioUser.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      let calendarEl = document.getElementById("calendar");

      let calendar = new FullCalendar.Calendar(calendarEl, {
        eventClick: function (info) {
          const event = info.event;
          idEventoSelecionado = event.id;

          document.querySelector(".modal-title").textContent = event.title;
          document.querySelector(".modal-body p").innerHTML =
            `<strong>Data:</strong> ${event.start.toLocaleDateString()}<br><strong>Descrição:</strong> ${event.extendedProps.descricao}`;

          if (event.extendedProps.imagem_url) {
            if (!document.getElementById("modal-img-evento")) {
              const img = document.createElement("img");
              img.id = "modal-img-evento";
              img.style.maxWidth = "100%";
              img.style.marginTop = "10px";
              document.querySelector(".modal-body").appendChild(img);
            }
            document.getElementById("modal-img-evento").src = event.extendedProps.imagem_url;
            document.getElementById("modal-img-evento").style.display = "block";
          } else {
            if (document.getElementById("modal-img-evento")) {
              document.getElementById("modal-img-evento").style.display = "none";
            }
          }

          document.getElementById("editNomeEvento").value = event.title;
          document.getElementById("editDataInicial").value = event.startStr;
          document.getElementById("editDataFinal").value = event.endStr
            ? new Date(new Date(event.endStr).setDate(new Date(event.endStr).getDate() - 1)).toISOString().split("T")[0]
            : event.startStr;
          document.getElementById("editCorEvento").value = event.backgroundColor || "#3788d8";
          document.getElementById("editDescricao").value = event.extendedProps.descricao || "";

          new bootstrap.Modal(document.querySelector(".modal")).show();
        },
        height: "auto",
        initialView: "dayGridMonth",
        locale: "pt-br",
        headerToolbar: {
          left: "prev,next today",
          center: "title",
          right: "customMonthPicker" // espaço para nosso seletor
        },
        customButtons: {
          customMonthPicker: {
            text: "Selecionar mês",
            click: function () {
              document.getElementById("monthPicker").showPicker();
            }
          }
        }
      });

      calendar.render();

      // Adiciona o input type=month no lugar do botão customizado
      let monthInput = document.createElement("input");
      monthInput.type = "month";
      monthInput.id = "monthPicker";
      monthInput.className = "form-control form-control-sm";
      monthInput.style.display = "inline-block";
      monthInput.style.width = "150px";
      monthInput.style.marginLeft = "10px";

      // Quando escolher o mês, ir para essa data
      monthInput.addEventListener("change", function () {
        if (this.value) {
          calendar.gotoDate(this.value + "-01");
        }
      });

      // Insere o input no header do calendário
      document.querySelector(".fc-toolbar-chunk:last-child").appendChild(monthInput);

      // Carrega eventos da API
      const res = await fetch("http://localhost:5000/datas");
      const eventos = await res.json();
      eventos.forEach(evt => {
        let dataFinal = new Date(evt.dataFinal);
        dataFinal.setDate(dataFinal.getDate() + 1);
        calendar.addEvent({
          id: evt.id,
          title: evt.nomeEvento,
          start: evt.dataInicial,
          end: dataFinal.toISOString().split("T")[0],
          color: evt.eventColor || "#3788d8",
          extendedProps: {
            descricao: evt.descricao || "",
            imagem_url: evt.imagem_url || null
          }
        });
      });
    });
  </script>
</head>

<body>
  <div class="divCabecalho">
    <div class="esquerda">
      <button id="evento">
        <a href="http://localhost/Estagio-Ferias---Calendario-Eniac/BACK-END/templates/login.html">
          Adicionar Evento
        </a>
      </button>
    </div>
    <div class="centro">
      <a href="https://www.eniac.edu.br/">
        <img src="http://localhost/Estagio-Ferias---Calendario-Eniac/imagens/path32.png" alt="" id="eniac" />
      </a>
    </div>
  </div>
  <div class="container-flex">
    <div id="calendar" class="mt-4"></div>

    <div class="modal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <p></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalEditarEvento" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="formEditarEvento">
            <div class="modal-header">
              <h5 class="modal-title"><strong>Editar Evento</strong></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
              <label for="editNomeEvento"><strong>Nome:</strong></label>
              <input type="text" id="editNomeEvento" class="form-control" required />

              <label for="editDataInicial"><strong>Data Inicial:</strong></label>
              <input type="date" id="editDataInicial" class="form-control" required />

              <label for="editDataFinal"><strong>Data Final:</strong></label>
              <input type="date" id="editDataFinal" class="form-control" required />

              <label for="editCorEvento"><strong>Cor:</strong></label>
              <input type="color" id="editCorEvento" class="form-control" />

              <label for="editDescricao"><strong>Descrição:</strong></label>
              <textarea id="editDescricao" class="form-control" rows="2"></textarea>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Salvar Alterações</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
</body>

</html>
